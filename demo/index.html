<html>

<head>
    <meta charset="utf-8">
    <title>gamepad.js demo</title>

    <link rel="icon" href="images/gamepad.png">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    <!--Blockly-->
    <script src="js/blockly/blockly_compressed.js"></script>
    <script src="js/blockly/blocks_compressed.js"></script>
    <script src="js/blockly/javascript_compressed.js"></script>
    <script src="js/blockly/en.js"></script>

    <!--gamepad.js-->
    <script src="../src/gamepad.js"></script>
</head>

<body>
    <header>
        <!--title-->
        <span class="title"> <div><a href="https://developers.google.com/blockly/">Blockly</a> <a style="font-size: 80%;">&</a> <a
                href="https://github.com/Paol-imi/gamepad.js">gamepad.js</a>: Maze</div></span>
        <vr></vr>
        <!--start switch-->
        <span class="switch_span">start</span>
        <label class="switch">
            <input id="start_check" type="checkbox">
            <span class="slider round"></span>
        </label>
        <vr></vr>
        <!--categories switch-->
        <span class="switch_span">categories</span>
        <label class="switch">
            <input id="categories_check" type="checkbox">
            <span class="slider round"></span>
        </label>
        <vr></vr>
        <!--level buttons-->
        <span class="switch_span">levels</span>
        <button class="button level" id="level_1">1</button>
        <button class="button level" id="level_2">2</button>
        <vr></vr>
    </header>

    <main>
        <!--game div-->
        <div id="game-div">
            <!--game 1-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="1" width="400px" height="400px"
                viewBox="0 0 400 400">
                <image xlink:href="images/maze1.png" class="maze" x="0" y="-1" width="400" height="399"></image>                
                <image id="finish1" xlink:href="images/marker.png" height="34" width="20" x="215" y="146"></image>
                <clipPath id="pegmanClipPath1">
                    <rect id="clipRect1" width="49" height="52" x="101" y="191"></rect>
                </clipPath>
                <image id="pegman1" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#pegmanClipPath1)" x="-95" y="191" transform="rotate(0, 0, 0)"></image>
                <g id="look" style="display: none;">
                    <path d="M 0,-15 a 15 15 0 0 1 15 15" stroke="#000"></path>
                    <path d="M 0,-35 a 35 35 0 0 1 35 35" stroke="#000"></path>
                    <path d="M 0,-55 a 55 55 0 0 1 55 55" stroke="#000"></path>
                </g>
            </svg>
            <!--game 2-->
            <svg xmlns="http://www.w3.org/2000/svg" style="display: none" version="1.1" id="2" width="400px" height="400px"
                viewBox="0 0 400 400">
                <image xlink:href="images/maze2.png" class="maze" x="0" y="0" width="400" height="400"></image>                
                <image id="finish2" xlink:href="images/marker.png" height="34" width="20" x="215" y="46"></image>
                <clipPath id="2pegmanClipPath">
                    <rect id="clipRect2" width="49" height="52" x="51" y="291"></rect>
                </clipPath>
                <image id="pegman2" xlink:href="images/pegman.png" height="52" width="1029"
                    clip-path="url(#2pegmanClipPath)" x="-145" y="291" transform="rotate(0, 0, 0)"></image>
                <g id="look" style="display: none;">
                    <path d="M 0,-15 a 15 15 0 0 1 15 15" stroke="#000"></path>
                    <path d="M 0,-35 a 35 35 0 0 1 35 35" stroke="#000"></path>
                    <path d="M 0,-55 a 55 55 0 0 1 55 55" stroke="#000"></path>
                </g>
            </svg>
            <!--capacity div-->
            <div id="capacity" style="display: none;">You have <span id="capacityNumber">10</span> blocks left.</div>
            <!--buttons-->
            <div class="buttons">
                <button id="play" class="button green" style="grid-area: 1">Play</button>
                <button id="pause" class="button green" style="grid-area: 2">Pause</button>
                <hr>
                <button id="forward" class="button blue" style="grid-area: 2">Forward</button>
                <button id="backward" class="button blue" style="grid-area: 3">Backward</button>
                <hr>
                <button id="load" class="button violet" style="grid-area: 1"> &nbsp;Load&ensp;code</button>
            </div>
        </div>
        <!--workspace div-->
        <div id="blockly-editor">
            <div id="blockly-div"></div>
            <!--toolbox without categories-->
            <xml id="toolbox" style="display: none">
                <block type="move_forward"></block>
                <block type="turn"></block>
                <block type="turn">
                    <field name="DIRECTION">3</field>
                </block>
                <block type="repeat_until"></block>
                <block type="if_path"></block>
                <block type="if_else_path"></block>
            </xml>
            <!--toolbox whit categories-->
            <xml id="toolbox_c" style="display: none">
                <category name="Controls" colour="285">
                    <block type="move_forward"></block>
                    <block type="turn"></block>
                    <block type="turn">
                        <field name="DIRECTION">3</field>
                    </block>
                </category>
                <category name="Logic" colour="120">
                    <block type="repeat_until"></block>
                    <block type="if_path"></block>
                    <block type="if_else_path"></block>
                </category>
                <!--category name="Functions" colour="290" custom="PROCEDURE"></category-->
            </xml>
        </div>
    </main>

    <!--load global parameters-->
    <script>
        // get parameters in url
        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
                vars[key] = value;
            });
            return vars;
        }

        // global vars
        let {
            start,
            categories,
            level
        } = getUrlVars()

        // update parameters
        start = start != undefined
        categories = categories != undefined
        level = (level == '1') ? 0 : 1

        // update the checkers
        if (start) document.getElementById('start_check').checked = true
        if (categories) document.getElementById('categories_check').checked = true

        // set the toolbox
        const toolbox = document.getElementById(categories ? 'toolbox_c' : 'toolbox')
    </script>

    <script src="js/levels.js"></script>
    <script src="js/gui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/index.js"></script>

    <!--link event to buttons-->
    <script>
        // update remaining block
        Blockly.getMainWorkspace().addChangeListener(() => {
            let capacity = Blockly.getMainWorkspace().remainingCapacity()
            if (capacity != Infinity) {
                // show capacity div
                document.getElementById('capacity').style.display = 'block'
                document.getElementById('capacityNumber').innerHTML = capacity
            } else {
                // hide capacity div
                document.getElementById('capacity').style.display = 'none'
            }
        })

        // link the buttons
        document.getElementById('load').onclick = () => game.loadCode()
        document.getElementById('level_1').onclick = () => game.loadLevel(levels[level = 0])
        document.getElementById('level_2').onclick = () => game.loadLevel(levels[level = 1])

        document.getElementById('forward').onclick = () => gamepad.forward() + game.gui.removeAnimation()
        document.getElementById('backward').onclick = () => gamepad.backward() + game.gui.removeAnimation()
        document.getElementById('play').onclick = () => gamepad.play()
        document.getElementById('pause').onclick = () => gamepad.pause()

        // get the url
        const getUrl = (start, categories) => {
            let url = []

            if(start) url.push('start=true')
            if(categories) url.push('categories=true')
            url.push('level='+(level+1))

            return 'index.html?' + url.join('&')
        }

        // add handlers
        document.getElementById('start_check').onclick =
            (event) => window.location.href = getUrl(event.target.checked, categories)

        document.getElementById('categories_check').onclick =
            (event) => window.location.href = getUrl(start, event.target.checked)

        // show capacity div
        if(level == 2) document.getElementById('capacity').style.display = 'block'
    </script>

    <!-- git hub link -->
    <a href="https://github.com/Paol-imi/gamepad.js" class="github-corner" aria-label="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250"
            style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg>
    </a>
</body>

</html>